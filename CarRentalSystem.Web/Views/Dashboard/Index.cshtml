@model CarRentalSystem.Web.ViewModels.Dashboard.UserDashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}



<!-- 3D Interactive Dashboard Scene Container -->
<div class="dashboard-3d-container">
    <!-- Parallax Background Layers -->
    <div class="parallax-layer dashboard-parallax-bg"></div>
    <div class="parallax-layer dashboard-dots-bg"></div>
    
    <!-- Animated Dots Container -->
    <div class="dashboard-animated-dots-container">
        <!-- Dynamic dots will be created by JavaScript -->
    </div>
    
    <!-- Interactive Particles -->
    <div class="dashboard-particles-3d"></div>
    
    <!-- Floating 3D Elements Container -->
    <div class="dashboard-floating-3d-container">
        <!-- Dynamic floating elements will be created by JavaScript -->
    </div>

    <!-- Dashboard Content Container -->
    <div class="dashboard-content-container">
        <!-- Dashboard Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1 class="dashboard-title">Car Rental Dashboard</h1>
                <p class="dashboard-subtitle">Welcome back, @Model.Customer.FullName</p>
            </div>
            <div class="header-right">
                <div class="header-actions">
                    <a href="https://wa.me/94777353481" target="_blank" class="btn btn-whatsapp" title="Contact Support">
                        <i class="bi bi-whatsapp"></i>
                    </a>
                </div>
                <div class="user-profile">
                    @if (!string.IsNullOrEmpty(Model.Customer.ProfileImagePath))
                    {
                        <img src="@Model.Customer.ProfileImagePath" alt="Profile" class="profile-img">
                    }
                    else
                    {
                        <img src="~/images/default-avatar.png" alt="Profile" class="profile-img">
                    }
                    <span class="profile-name">@Model.Customer.FullName</span>
                </div>
            </div>
        </header>

        <!-- Key Metrics Cards -->
        <div class="metrics-grid">
                    <div class="metric-card bookings-card">
                        <div class="metric-icon">
                            <i class="bi bi-calendar-check"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number">@Model.TotalBookings</div>
                            <div class="metric-label">Total Bookings</div>
                            <div class="metric-trend positive">
                                <i class="bi bi-arrow-up"></i>
                                <span>All time</span>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card active-card">
                        <div class="metric-icon">
                            <i class="bi bi-car-front"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number">@Model.ActiveRentals</div>
                            <div class="metric-label">Active Rentals</div>
                            <div class="metric-trend neutral">
                                <i class="bi bi-dash"></i>
                                <span>Currently ongoing</span>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card spent-card">
                        <div class="metric-icon">
                            <i class="bi bi-currency-dollar"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number">$@(Model.TotalSpent.ToString("N0"))</div>
                            <!-- Debug: TotalSpent = @Model.TotalSpent, Formatted = @(Model.TotalSpent.ToString("N0")) -->
                            <div class="metric-label">Total Spent</div>
                            <div class="metric-trend positive">
                                <i class="bi bi-arrow-up"></i>
                                <span>All time</span>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Charts Section -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Booking Trends</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active">Monthly</button>
                                <button class="chart-btn">Weekly</button>
                                <button class="chart-btn">Yearly</button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="bookingTrendsChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Spending Analytics</h3>
                        </div>
                        <div class="chart-content">
                            <canvas id="spendingAnalyticsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Bookings Section -->
                <div class="recent-section">
                    <div class="section-header">
                        <h3 class="section-title">Recent Bookings</h3>
                        <a href="#" class="view-all-btn">View All</a>
                    </div>
                    <div class="bookings-list">
                        @if (Model.RecentBookings.Any())
                        {
                            @foreach (var booking in Model.RecentBookings.Take(5))
                            {
                                <div class="booking-item">
                                    <div class="booking-info">
                                        <div class="booking-car">@booking.CarName</div>
                                        <div class="booking-details">
                                            <span class="booking-date">@booking.PickupDate.ToString("MMM dd, yyyy")</span>
                                            <span class="booking-duration">@((booking.ReturnDate - booking.PickupDate).Days) days</span>
                                        </div>
                                    </div>
                                    <div class="booking-status">
                                        <span class="status-badge @booking.BookingStatus.ToLower().Replace(" ", "-")">@booking.BookingStatus</span>
                                        <div class="booking-amount">$@booking.TotalCost.ToString("N0")</div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="empty-state">
                                <i class="bi bi-calendar-x"></i>
                                <p>No recent bookings found</p>
                                <a asp-controller="Cars" asp-action="Search" class="btn btn-primary">Book Your First Car</a>
                            </div>
                        }
                    </div>
                </div>

    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/interactive-user-dashboard.css" />
}

@section Scripts {
    <!-- Three.js for 3D Effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Chart.js and Animation Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.0/dist/vanilla-tilt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <!-- Temporarily disabled to test content visibility -->
    <!-- <script src="~/js/dashboard-interactive.js"></script> -->
    <!-- <script src="~/js/dashboard-charts.js"></script> -->
    <!-- <script src="~/js/sidebar-3d.js"></script> -->
    <!-- <script src="~/js/dashboard-3d-full.js"></script> -->
    <!-- <script src="~/js/dashboard-3d-effects.js" asp-append-version="true"></script> -->
    
    <script>
        // Static values displayed directly from server
        
        // Counter animation function removed - using static values
        
        // Simple dashboard initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded successfully');
            
            // Ensure content is visible
            const contentContainer = document.querySelector('.dashboard-content-container');
            if (contentContainer) {
                contentContainer.style.display = 'block';
                contentContainer.style.visibility = 'visible';
                contentContainer.style.opacity = '1';
                console.log('Content container made visible');
            }
            
            // Counter animations removed - using static values from server
        });
    </script>
}